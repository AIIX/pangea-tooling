<?xml version='1.0' encoding='UTF-8'?>
<flow-definition plugin="workflow-job@2.9">
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
  </properties>
  <definition class="org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition" plugin="workflow-cps@2.23">
    <script>env.DIST = &apos;xenial&apos;
env.TYPE = &apos;user&apos;
env.APTLY_REPOSITORY = &apos;<%= repo %>&apos;

node(&apos;master&apos;) {
    wrap([$class: &apos;TimestamperBuildWrapper&apos;]) {
        stage &apos;Checkout&apos;
        git url: &apos;https://github.com/jriddell/appstream-generator.git&apos;
        sh &quot;make update-submodule&quot;

        stage &apos;Repository Setup&apos;
        sh &apos;rsync -avzH --delete neonarchives@archive-api.kde.org:aptly/public/$APTLY_REPOSITORY/* aptly-repository/&apos;

        stage &apos;Process&apos;
        sh &apos;~/tooling/kci/contain.rb /var/lib/jenkins/ci-tooling/nci/asgen.rb&apos;

        stage &apos;Publish&apos;
        sh &apos;~/tooling/nci/asgen_push.rb&apos;
        sh &apos;mkdir -p /var/www/metadata/appstream/$APTLY_REPOSITORY || true&apos;
        sh &apos;cp -rv run/export/. /var/www/metadata/appstream/$APTLY_REPOSITORY&apos;

        stage &apos;Cleanup&apos;
        sh &apos;#rm -rf aptly-repository&apos;
    }
}
</script>
    <sandbox>true</sandbox>
  </definition>
  <triggers/>
</flow-definition>
